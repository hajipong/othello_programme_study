# 1-2. 画面を作ろう　SVGの出力をJS側にする

固定部分はHTML側に書いても良いのですが、
盤の大きさなどの基準を管理したい場合、JS側で書き出すようにしておいた方が便利です。

JavaScriptの基本的な構文などはここでは扱わないので、ここのコードがわからない場合は入門的なものを先に調べておくことをお勧めします。

コードのポイントをかいつまんで話します。

## JavaScriptでSVG内の要素を作成する

JSにて要素を作成する際は`createElement`でタグ名を指定して作成しますが、SVG関連のタグにおいてはこの方法で作成できません。

代わりに少し長くなりますが、`document.createElementNS('http://www.w3.org/2000/svg', 'rect');`という記述で要素を作成できます。
作成後の操作は同じで、`setAttribute`などをして`appendChild(rect)`で親要素に追加します。

## 盤上線をループで座標計算

盤上の線は8マス分の間7本の線をひきます。↓はループで回したiに合わせてy座標を動かして横線を描くところです。
```
    for (let i = 1; i < 8; i++) {
        let y = board_top_y + i * cell_size;
        draw_board_line(board_left_x, y, board_right_x, y);
    }
```

## 単純で固定的な部分でもしっかりリファクタする習慣をつける

プログラムの練習という意味を兼ねて、とりあえず動くコードではなく開発現場で通用するような読みやすくバグの発生しにくいコードを書くように心がけていきます。

### ポイント１：決まった数字は定数にしよう
コードの各部分に決まっている数字を埋め込むのは、後で自分に跳ね返ってきます。
例えばマスの大きさをちょっと変えたい時に死にます。

座標系を扱う時は最初は使わなくてもオフセットの数字を用意しておくのもコツです。
```
const cell_size = 40;
const board_offset_x = 0;
const board_offset_y = 0;
```

### ポイント２：同じ値でも意味が違う定数は分けよう
盤の左端のX座標は、つまりはオフセットの値だな！と、コード内に`board_offset_x`とそのまま書くのではなく、
「盤の左端のX座標」という意味のある名前で定義付けましょう。「結果的に同じものでも、意味的には別物」という視点を持っておきましょう。

今後コードが複雑になっていく上で、こういう名前付けがバグを防いでくれます。
```
const board_size = cell_size * 8;
const board_left_x = board_offset_x;
const board_right_x = board_offset_x + board_size;
const board_top_y = board_offset_y;
const board_bottom_y = board_offset_y + board_size;
```

### ポイント３：メソッドの分け方は仕事の内容
大枠の仕事が決まってるからと、全ての処理を1メソッドで書いてしまう人も多いと思います。

しかしこういうところでコードの全体の複雑さが上がってしまいます。複雑さが上がると、他人はもちろん自分でも自分で書いたコードがわからなくなってしまいます。

ここでは「盤を描画する」のメソッドの中で背景と線の実際のタグを作成する部分を分離しました。
`draw_board()`でやる仕事のうち「背景を実際にタグで描画」「線を実際にタグで描画」と明確に仕事内容を切り出せるものを分離して、本体は座標を決めてそれぞれを呼び出すに止まります。

```
// オセロ盤の土台部分を描画します。
function draw_board() {
...
// 背景部分の描画
function draw_board_background() {
...
// 盤上の線の描画
function draw_board_line(x1, y1, x2, y2) {
```

メソッドを分ける基準は、再利用するからという理由もありますが、どちらかというと部品と組み立てとか、タスクと業務のように、分けることによって部品管理できるようにする意図が強いです。

### ポイント４：一番大事なのは名前付け
「こういう時は、こうしたほうが良い」というのTIPS的な技術も大事ですが、大前提として「変数やメソッドが適切な名前が付けられていること」が根幹になります。

ポイント2でも同じような事を言いましたが、「このメソッドでやってるお仕事と名前が一致しているか」「この変数の意味が名前で表現できているか」を意識しつつ、省略もなるべくしないように心がけると良いでしょう。

お仕事の名前が適切に付けられていれば、その範囲外のお仕事を書きだした時に「あぁこれは別メソッドがいいんだな」ということに気が付けるようになります。

- - -
コード

https://github.com/hajipong/othello_programme_study/compare/step1...step1_2
- - -

[＜前](https://github.com/hajipong/othello_programme_study/tree/step1)　
[次＞](https://github.com/hajipong/othello_programme_study/tree/step1_3)
